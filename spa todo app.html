<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>SPA todo app</title>
	<style>
		.hidden	{
			display: none;
		}
	</style>
	<script src="hua3.js"></script>
</head>
<body>
	<div>
		<button class="hua-tab" data-page=todo-new>点击创建todo 页面</button>
		<button class="hua-tab" data-page=todo-wrapper>点击显示todo list</button>
	</div>
	<div class="div-page todo-new">
		<input id="id-input" type="text">
		<button id="id-add-button">click add todo</button>
	</div>
	<div class="div-page todo-wrapper">
		
	</div>
	
	<script>
		// todo API
		var createTodo = function(task) {
			t = {
				task: task,
				done: false,
			}
			return t 
		}
		// 保存todoList 到localStorage 中
		var saveTodos = function(todoList) {
			localStorage.todos = JSON.stringify(todoList)
		}
		// 保存todo
		var saveTodo = function(todo) {
			// var todoStr = localStorage.todos
			// if (todoStr == undefined) {
			// 	todoStr = '[]'
			// } 
			// var todoList = JSON.parse(todoStr)
			var todoList = loadTodos()
			todoList.push(todo)
			saveTodos(todoList)				
		}

		var loadTodos = function() {
			var todoStr = localStorage.todos
			if (todoStr == undefined) {
				todoStr = '[]'
			} 
			var todoList = JSON.parse(todoStr)
			return todoList
		}
	</script>
	<script>
	// 创建todo 的事件
		var bindEvents = function() {
			var button = e('#id-add-button')
			bindEvent(button, 'click', function(event) {
				var input = e('#id-input')
				var task = input.value
				log("task", task)
				var todo = createTodo(task)
				saveTodo(todo)
				// 点击 add
				var todoWraper = e('.todo-wrapper')
				todoWraper.innerHTML = ''	
				showTodoList()
			})
		}
	</script>
	<script>
		var templateTodo = function(todo) {
			var task = todo.task
			var t = `
				<div>
					${task}
				</div>
			`
			return t 
		}
		var insertTodos = function(todoList) {
			var todoWraper = e('.todo-wrapper')
			for (var i = 0; i < todoList.length; i++) {
				var todo = todoList[i]
				var t = templateTodo(todo)
				appendHTML(todoWraper, t)
			}
		}
	// 加载todo 显示在页面上
		var showTodoList = function() {
			var todoList = loadTodos()
			insertTodos(todoList)
		}
	</script>
	<script>
		// var bindAll = function(selector, eventName, callback) {
		bindAll('.hua-tab', click, function(event){
			var btn = event.target
			var page = btn.dataset.page
			if (page == 'todo-new') {
				var pages = es('.div-page')
				for (var i = 0; i < pages.length; i++) {
					pages[i].classList.add('hidden')
					btn.classList.remove('hidden')
				}
			} else if (page = 'todo-wrapper') {
				var pages = es('.div-page')
				for (var i = 0; i < pages.length; i++) {
					pages[i].classList.add('hidden')
					btn.classList.remove('hidden')
				}
			}
		})
	</script>
	<script>
		var __main = function() {
			bindEvents()
			showTodoList()
		}
		__main()
	</script>
</body>
</html>